name: AI Article Generation & Publishing Pipeline

on:
  schedule:
    - cron: '15 */8 * * *'  # 8æ™‚é–“ã”ã¨ï¼ˆ3:15, 11:15, 19:15ï¼‰ã«å®Ÿè¡Œ
  workflow_dispatch:        # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  generate-and-publish:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Pull latest changes to avoid conflicts
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Pull latest changes from main branch
          echo "ðŸ“¥ Pulling latest changes from main branch..."
          git pull --rebase origin main || {
            echo "âš ï¸  Rebase failed, attempting merge strategy..."
            git pull --no-rebase origin main || {
              echo "âŒ Both rebase and merge failed, continuing with current state..."
              git status
            }
          }
          
          echo "âœ… Repository synchronized with latest changes"
          git log --oneline -3

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm install
          npm install -g @google/gemini-cli
          mkdir -p _temp

      - name: Generate topic list for AI industry
        id: generate_topics
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          export GEMINI_API_KEY="$GEMINI_API_KEY"
          DATE_STR=$(date '+%Yå¹´%mæœˆ%dæ—¥')
          
          # Generate list of current AI topics
          gemini -m "gemini-2.5-flash" --prompt "WebSearch: AIæ¥­ç•Œ æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ ãƒˆãƒ¬ãƒ³ãƒ‰ è©±é¡Œ 2025ã€‚AIæ¥­ç•Œã§æ³¨ç›®ã•ã‚Œã¦ã„ã‚‹æœ€æ–°ã®è©±é¡Œãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’Webæ¤œç´¢ã§èª¿æŸ»ã—ã€ä»¥ä¸‹ã®å½¢å¼ã§10å€‹ã®å…·ä½“çš„ãªè©±é¡Œã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚å„è©±é¡Œã¯1è¡Œã§ã€ç°¡æ½”ã«è¡¨ç¾ã—ã¦ãã ã•ã„ã€‚ä¾‹: 1. OpenAIã®æ–°ãƒ¢ãƒ‡ãƒ«ç™ºè¡¨, 2. Google DeepMindã®ç ”ç©¶æˆæžœ, 3. ç”ŸæˆAIã®ä¼æ¥­å°Žå…¥äº‹ä¾‹, 4. AIè¦åˆ¶æ³•æ¡ˆã®å‹•å‘, 5. è‡ªå‹•é‹è»¢æŠ€è¡“ã®é€²å±•...å®Ÿéš›ã®æ¤œç´¢çµæžœã«åŸºã¥ã„ã¦ã€å…·ä½“çš„ãªä¼æ¥­åãƒ»è£½å“åãƒ»äººåã‚’å«ã‚ãŸç¾å®Ÿçš„ãªè©±é¡Œã‚’10å€‹ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚" > _temp/topics-list.txt
          
          echo "Generated topics list:"
          cat _temp/topics-list.txt

      - name: Generate articles for all topics
        id: generate_articles
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          export GEMINI_API_KEY="$GEMINI_API_KEY"
          DATE_STR=$(date '+%Yå¹´%mæœˆ%dæ—¥')
          
          # Extract topics from the generated list
          TOPICS=$(grep -E "^[0-9]+\." _temp/topics-list.txt | head -10)
          echo "Available topics:"
          echo "$TOPICS"
          
          # Very minimal duplicate checking - only check today's articles
          EXISTING_TODAY=""
          TODAY=$(date +%Y-%m-%d)
          if ls _posts/${TODAY}-*.md 1> /dev/null 2>&1; then
            EXISTING_TODAY=$(grep -h "^title:" _posts/${TODAY}-*.md 2>/dev/null || echo "")
            echo "Found existing articles today: $(echo "$EXISTING_TODAY" | wc -l) articles"
          else
            echo "No existing articles found for today ($TODAY)"
          fi
          
          # Process each topic with enhanced debugging
          TOPIC_INDEX=1
          ARTICLES_CREATED=0
          MAX_ARTICLES=10
          
          echo "=== Starting article generation for $MAX_ARTICLES articles ==="
          echo "Topics to process:"
          echo "$TOPICS"
          
          # Use process substitution to avoid subshell variable scope issues
          while IFS= read -r TOPIC_LINE; do
            echo "--- Processing topic line: '$TOPIC_LINE' ---"
            
            # Limit to maximum number of articles
            if [ "$ARTICLES_CREATED" -ge "$MAX_ARTICLES" ]; then
              echo "âœ… Reached maximum articles limit ($MAX_ARTICLES), stopping."
              break
            fi
            
            # Skip empty lines
            if [ -z "$TOPIC_LINE" ]; then
              echo "â­ï¸  Skipping empty line"
              continue
            fi
            
            SELECTED_TOPIC=$(echo "$TOPIC_LINE" | sed 's/^[0-9]*\. *//')
            echo "ðŸ“ Selected topic: '$SELECTED_TOPIC'"
            
            # Very lenient duplicate checking - only exact title and date match
            SKIP_TOPIC=false
            if [ ! -z "$EXISTING_TODAY" ]; then
              if echo "$EXISTING_TODAY" | grep -Fq "title: \"$SELECTED_TOPIC\""; then
                echo "âš ï¸  Skipping exact duplicate from today: $SELECTED_TOPIC"
                SKIP_TOPIC=true
              fi
            fi
            
            if [ "$SKIP_TOPIC" = true ]; then
              echo "â­ï¸  Skipping duplicate topic"
              continue
            fi
            
            echo "Processing topic $TOPIC_INDEX: $SELECTED_TOPIC"
            
            # Determine category based on topic content
            CATEGORY="æœ€æ–°å‹•å‘"  # Default
            if [[ "$SELECTED_TOPIC" =~ (ç ”ç©¶|è«–æ–‡|arXiv|å­¦ä¼š|Research|Paper) ]]; then
              CATEGORY="ç ”ç©¶è«–æ–‡"
            elif [[ "$SELECTED_TOPIC" =~ (æŠ€è¡“|ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ |ä»•çµ„ã¿|å®Ÿè£…|é–‹ç™º|Technology|Algorithm) ]]; then
              CATEGORY="æŠ€è¡“è§£èª¬"
            elif [[ "$SELECTED_TOPIC" =~ (å°Žå…¥|äº‹ä¾‹|æ´»ç”¨|ROI|æˆæžœ|ä¼æ¥­|Case|Implementation) ]]; then
              CATEGORY="å®Ÿè£…äº‹ä¾‹"
            elif [[ "$SELECTED_TOPIC" =~ (å¸‚å ´|åˆ†æž|äºˆæ¸¬|ãƒˆãƒ¬ãƒ³ãƒ‰|æŠ•è³‡|Market|Analysis|Trend) ]]; then
              CATEGORY="æ¥­ç•Œåˆ†æž"
            elif [[ "$SELECTED_TOPIC" =~ (ãƒ‹ãƒ¥ãƒ¼ã‚¹|ç™ºè¡¨|ãƒªãƒªãƒ¼ã‚¹|News|Release|ç™ºå£²|æ–°è£½å“) ]]; then
              CATEGORY="æœ€æ–°å‹•å‘"
            fi
            
            echo "Selected category for '$SELECTED_TOPIC': $CATEGORY"
            
            # Generate category-specific prompts
            case $CATEGORY in
              "æœ€æ–°å‹•å‘")
                PROMPT="WebSearch: ${DATE_STR} ${SELECTED_TOPIC} AIæ¥­ç•Œ ãƒ‹ãƒ¥ãƒ¼ã‚¹ ä¼æ¥­ç™ºè¡¨ã€‚ã€Œ${SELECTED_TOPIC}ã€ã«ã¤ã„ã¦ã€AIæ¥­ç•Œã®æœ€æ–°å‹•å‘ã¨ã—ã¦ã€Webæ¤œç´¢ã§æœ€æ–°æƒ…å ±ã‚’èª¿æŸ»ã—ã€ALLFORCES AIæƒ…å ±ãƒ¡ãƒ‡ã‚£ã‚¢ã®èª­è€…å‘ã‘ã®è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚è¦ä»¶ï¼šå®Ÿéš›ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚„ä¼æ¥­ç™ºè¡¨ã«åŸºã¥ãå…·ä½“çš„ãªå†…å®¹ã€ç™ºè¡¨æ—¥æ™‚ãƒ»ä¼æ¥­åãƒ»äººåãƒ»å…·ä½“çš„æ•°å€¤ã‚’æ­£ç¢ºã«è¨˜è¼‰ã€æŠ•è³‡å®¶ã‚„æŠ€è¡“è€…ãŒçŸ¥ã‚ŠãŸã„æƒ…å ±ã‚’ç¶²ç¾…ã€3000-4000æ–‡å­—ã€Markdownå½¢å¼ã€‚æ§‹æˆï¼š# ${SELECTED_TOPIC} ## ãƒ‹ãƒ¥ãƒ¼ã‚¹æ¦‚è¦ ## ç™ºè¡¨å†…å®¹ã®è©³ç´° ## æŠ€è¡“çš„èƒŒæ™¯ ## å¸‚å ´ã¸ã®å½±éŸ¿ ## ç«¶åˆä»–ç¤¾ã®å‹•å‘ ## ä»Šå¾Œã®å±•æœ›"
                ;;
              "æŠ€è¡“è§£èª¬")
                PROMPT="WebSearch: ${DATE_STR} ${SELECTED_TOPIC} AI æŠ€è¡“è§£èª¬ ä»•çµ„ã¿ ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€‚ã€Œ${SELECTED_TOPIC}ã€ã«ã¤ã„ã¦ã€AIæŠ€è¡“ã®è©³ç´°è§£èª¬ã¨ã—ã¦ã€Webæ¤œç´¢ã§æœ€æ–°ã®æŠ€è¡“æƒ…å ±ã‚’èª¿æŸ»ã—ã€æŠ€è¡“è€…å‘ã‘ã®è©³ç´°ãªè§£èª¬è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚è¦ä»¶ï¼šæŠ€è¡“çš„ãªä»•çµ„ã¿ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ã€æ•°å¼ã‚„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®èª¬æ˜Žã€å®Ÿè£…ä¾‹ã‚„å¿œç”¨äº‹ä¾‹ã€è«–æ–‡ã‚„ç ”ç©¶æˆæžœã®å¼•ç”¨ã€3500-4500æ–‡å­—ã€Markdownå½¢å¼ã€‚æ§‹æˆï¼š# ${SELECTED_TOPIC} ## æŠ€è¡“æ¦‚è¦ ## ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä»•çµ„ã¿ ## å®Ÿè£…ä¸Šã®è€ƒæ…®ç‚¹ ## æ—¢å­˜æ‰‹æ³•ã¨ã®æ¯”è¼ƒ ## å¿œç”¨äº‹ä¾‹ ## ä»Šå¾Œã®ç™ºå±•"
                ;;
              "å®Ÿè£…äº‹ä¾‹") 
                PROMPT="WebSearch: ${DATE_STR} ${SELECTED_TOPIC} AI å°Žå…¥äº‹ä¾‹ æ´»ç”¨äº‹ä¾‹ æˆæžœã€‚ã€Œ${SELECTED_TOPIC}ã€ã«ã¤ã„ã¦ã€AIå®Ÿè£…ãƒ»å°Žå…¥äº‹ä¾‹ã¨ã—ã¦ã€Webæ¤œç´¢ã§å®Ÿéš›ã®æ´»ç”¨äº‹ä¾‹ã‚’èª¿æŸ»ã—ã€å®Ÿè·µçš„ãªè¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚è¦ä»¶ï¼šå…·ä½“çš„ãªå°Žå…¥ä¼æ¥­åãƒ»æ¥­ç•Œãƒ»è¦æ¨¡ã€å°Žå…¥å‰å¾Œã®åŠ¹æžœæ¸¬å®šã€æŠ€è¡“çš„å®Ÿè£…æ–¹æ³•ã€ROIã‚„æˆæžœæŒ‡æ¨™ã€èª²é¡Œã¨è§£æ±ºç­–ã€3000-4000æ–‡å­—ã€Markdownå½¢å¼ã€‚æ§‹æˆï¼š# ${SELECTED_TOPIC} ## äº‹ä¾‹æ¦‚è¦ ## å°Žå…¥èƒŒæ™¯ã¨èª²é¡Œ ## æŠ€è¡“å®Ÿè£…ã®è©³ç´° ## å°Žå…¥åŠ¹æžœã¨æˆæžœ ## èª²é¡Œã¨å¯¾å¿œç­– ## ä»–æ¥­ç•Œã¸ã®å¿œç”¨å¯èƒ½æ€§"
                ;;
              "æ¥­ç•Œåˆ†æž")
                PROMPT="WebSearch: ${DATE_STR} ${SELECTED_TOPIC} AI æ¥­ç•Œåˆ†æž å¸‚å ´å‹•å‘ ãƒˆãƒ¬ãƒ³ãƒ‰ã€‚ã€Œ${SELECTED_TOPIC}ã€ã«ã¤ã„ã¦ã€ç‰¹å®šæ¥­ç•Œã®AIæ´»ç”¨å‹•å‘åˆ†æžã¨ã—ã¦ã€Webæ¤œç´¢ã§æ¥­ç•Œæƒ…å ±ã‚’èª¿æŸ»ã—ã€æˆ¦ç•¥çš„ãªåˆ†æžè¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚è¦ä»¶ï¼šå¸‚å ´è¦æ¨¡ãƒ»æˆé•·çŽ‡ãƒ»ä¸»è¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†æžã€æŠ€è¡“ãƒˆãƒ¬ãƒ³ãƒ‰ã¨æ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã€è¦åˆ¶å‹•å‘ã€æŠ•è³‡å‹•å‘ã€ç«¶åˆçŠ¶æ³ã€3500-4500æ–‡å­—ã€Markdownå½¢å¼ã€‚æ§‹æˆï¼š# ${SELECTED_TOPIC} ## æ¥­ç•Œæ¦‚æ³ ## AIæ´»ç”¨ã®ç¾çŠ¶ ## ä¸»è¦ä¼æ¥­ã®å–ã‚Šçµ„ã¿ ## æŠ€è¡“ãƒˆãƒ¬ãƒ³ãƒ‰ ## å¸‚å ´äºˆæ¸¬ ## æŠ•è³‡ãƒ»è¦åˆ¶å‹•å‘"
                ;;
              "ç ”ç©¶è«–æ–‡")
                PROMPT="WebSearch: ${DATE_STR} ${SELECTED_TOPIC} AI è«–æ–‡ ç ”ç©¶ å­¦ä¼š arXivã€‚ã€Œ${SELECTED_TOPIC}ã€ã«ã¤ã„ã¦ã€AIç ”ç©¶è«–æ–‡ã®è§£èª¬ã¨ã—ã¦ã€Webæ¤œç´¢ã§æœ€æ–°ã®ç ”ç©¶æƒ…å ±ã‚’èª¿æŸ»ã—ã€ç ”ç©¶è€…ãƒ»æŠ€è¡“è€…å‘ã‘ã®è«–æ–‡è§£èª¬è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚è¦ä»¶ï¼šè«–æ–‡ã®æ–°è¦æ€§ã¨è²¢çŒ®ã‚’æ˜Žç¢ºåŒ–ã€æ‰‹æ³•ãƒ»å®Ÿé¨“çµæžœã®è©³ç´°èª¬æ˜Žã€æ—¢å­˜ç ”ç©¶ã¨ã®æ¯”è¼ƒã€å®Ÿç”¨åŒ–ã®å¯èƒ½æ€§ã€æ‰¹åˆ¤çš„è©•ä¾¡ã€3500-4500æ–‡å­—ã€Markdownå½¢å¼ã€‚æ§‹æˆï¼š# ${SELECTED_TOPIC} ## ç ”ç©¶æ¦‚è¦ ## ææ¡ˆæ‰‹æ³• ## å®Ÿé¨“çµæžœã¨è©•ä¾¡ ## æ—¢å­˜ç ”ç©¶ã¨ã®æ¯”è¼ƒ ## å®Ÿç”¨åŒ–ã¸ã®é“ç­‹ ## ä»Šå¾Œã®ç ”ç©¶èª²é¡Œ"
                ;;
              *)
                PROMPT="WebSearch: ${DATE_STR} ${SELECTED_TOPIC} AIæ¥­ç•Œã€‚ã€Œ${SELECTED_TOPIC}ã€ã«ã¤ã„ã¦Webæ¤œç´¢ã§èª¿æŸ»ã—ã€è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"
                ;;
            esac
            
            # Generate article based on category-specific prompt
            echo "Generating article for topic: $SELECTED_TOPIC (Category: $CATEGORY)"
            gemini -m "gemini-2.5-flash" --prompt "$PROMPT" > "_temp/article-${TOPIC_INDEX}.md"
            
            # ã‚‚ã—gemini-cliãŒå¤±æ•—ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
            if [ ! -f "_temp/article-${TOPIC_INDEX}.md" ] || [ ! -s "_temp/article-${TOPIC_INDEX}.md" ]; then
              echo "Failed to generate article for topic: $SELECTED_TOPIC"
              TOPIC_INDEX=$((TOPIC_INDEX + 1))
              continue
            fi
            
            # Create the final article file
            echo "Creating final article file for: $SELECTED_TOPIC"
            
            # è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—ï¼ˆã‚ˆã‚Šå …ç‰¢ãªå‡¦ç†ï¼‰
            TITLE=$(grep -m 1 "^# " "_temp/article-${TOPIC_INDEX}.md" | sed 's/^# //' | sed 's/[[:space:]]*$//')
            
            # ã‚¿ã‚¤ãƒˆãƒ«ãŒå–å¾—ã§ããªã„å ´åˆã¯è©±é¡Œãƒ™ãƒ¼ã‚¹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä½¿ç”¨
            if [ -z "$TITLE" ] || [ "$TITLE" = "markdown" ] || [[ "$TITLE" == *'```'* ]]; then
              TITLE="$SELECTED_TOPIC"
            fi
            
            # ãƒ•ã‚¡ã‚¤ãƒ«åç”¨ã«ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›
            SLUG=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-zA-Z0-9\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/-/g' | sed 's/--*/-/g' | sed 's/^-\|-$//g')
            
            # æ—¥ä»˜ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆé‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ç•ªå·ã‚’è¿½åŠ ï¼‰
            FILENAME="$(date +%Y-%m-%d)-${TOPIC_INDEX}-$SLUG.md"
            
            # ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®ã‚¿ã‚°ã¨excerptã‚’è¨­å®š
            case $CATEGORY in
              "æœ€æ–°å‹•å‘")
                TAGS='["AI", "æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹", "æ¥­ç•Œå‹•å‘", "ä¼æ¥­ç™ºè¡¨"]'
                EXCERPT="AIæ¥­ç•Œã®æœ€æ–°å‹•å‘ã«ã¤ã„ã¦ã€ä¼æ¥­ç™ºè¡¨ã‚„æ¥­ç•Œãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’åŸºã«è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚"
                ;;
              "æŠ€è¡“è§£èª¬")
                TAGS='["AI", "æŠ€è¡“è§£èª¬", "ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ", "å®Ÿè£…"]'
                EXCERPT="AIæŠ€è¡“ã®ä»•çµ„ã¿ã¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¤ã„ã¦ã€æŠ€è¡“çš„ãªè¦³ç‚¹ã‹ã‚‰è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚"
                ;;
              "å®Ÿè£…äº‹ä¾‹")
                TAGS='["AI", "å°Žå…¥äº‹ä¾‹", "å®Ÿè£…", "ROI"]'
                EXCERPT="ä¼æ¥­ã®AIå°Žå…¥äº‹ä¾‹ã¨å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ã€å…·ä½“çš„ãªæˆæžœã‚’å«ã‚ã¦è§£èª¬ã—ã¾ã™ã€‚"
                ;;
              "æ¥­ç•Œåˆ†æž")
                TAGS='["AI", "å¸‚å ´åˆ†æž", "ãƒˆãƒ¬ãƒ³ãƒ‰", "æŠ•è³‡"]'
                EXCERPT="AIæ¥­ç•Œã®å¸‚å ´å‹•å‘ã¨å°†æ¥å±•æœ›ã«ã¤ã„ã¦ã€ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦åˆ†æžã—ã¾ã™ã€‚"
                ;;
              "ç ”ç©¶è«–æ–‡")
                TAGS='["AI", "ç ”ç©¶è«–æ–‡", "å­¦è¡“", "æœ€æ–°ç ”ç©¶"]'
                EXCERPT="AIåˆ†é‡Žã®æœ€æ–°ç ”ç©¶è«–æ–‡ã«ã¤ã„ã¦ã€æŠ€è¡“çš„ãªå†…å®¹ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ã—ã¾ã™ã€‚"
                ;;
              *)
                TAGS='["AI", "æ©Ÿæ¢°å­¦ç¿’", "æŠ€è¡“è§£èª¬", "æœ€æ–°ç ”ç©¶"]'
                EXCERPT="æœ€æ–°ã®AIæŠ€è¡“å‹•å‘ã«ã¤ã„ã¦ã€Googleæ¤œç´¢ã§èª¿æŸ»ã—ãŸæœ€æ–°æƒ…å ±ã‚’åŸºã«è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚"
                ;;
            esac
            
            # Front matterã‚’ä½œæˆ
            cat > "_posts/$FILENAME" << EOF
          ---
          layout: post
          title: "$TITLE"
          date: $(date +%Y-%m-%d\ %H:%M:%S\ %z)
          categories: ["$CATEGORY"]
          tags: $TAGS
          author: "AIè¨˜äº‹ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ "
          excerpt: "$EXCERPT"
          reading_time: 8
          ---
          EOF
            
            # è¨˜äº‹æœ¬æ–‡ã‚’è¿½åŠ ï¼ˆmarkdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯è¨˜å·ã‚’é™¤åŽ»ï¼‰
            sed '1d' "_temp/article-${TOPIC_INDEX}.md" | sed '/^```markdown$/d' | sed '/^```$/d' >> "_posts/$FILENAME"
            
            echo "âœ… Generated article $TOPIC_INDEX: $FILENAME"
            echo "ðŸ“„ Title: $TITLE"
            echo "ðŸ“‚ Category: $CATEGORY"
            
            TOPIC_INDEX=$((TOPIC_INDEX + 1))
            ARTICLES_CREATED=$((ARTICLES_CREATED + 1))
            
            echo "ðŸ“ˆ Articles created so far: $ARTICLES_CREATED/$MAX_ARTICLES"
            echo ""
          done <<< "$TOPICS"
          
          echo "=== Article generation completed ==="
          echo "âœ… Successfully created $ARTICLES_CREATED articles out of $MAX_ARTICLES maximum"

      - name: Lint and Fix Generated Articles
        run: |
          # textlintã§è¨˜äº‹ã‚’æ ¡æ­£ï¼ˆã‚¨ãƒ©ãƒ¼ãŒã‚ã£ã¦ã‚‚ç¶™ç¶šï¼‰
          for article_file in _temp/article-*.md; do
            if [ -f "$article_file" ]; then
              npx textlint "$article_file" --fix || echo "Textlint completed with warnings for $article_file"
            fi
          done


      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1'
          bundler-cache: true

      - name: Install Jekyll dependencies
        run: |
          # GemfileãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã®ã§ã€bundlerã§ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          bundle install

      - name: Build with Jekyll
        run: bundle exec jekyll build

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './_site'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        with:
          timeout: 60000  # 1 minute timeout

      - name: Commit and push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add _posts/*
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            ARTICLE_COUNT=$(find _posts -name "$(date +%Y-%m-%d)-*.md" | wc -l)
            git commit -m "feat: Add $ARTICLE_COUNT new AI articles - $(date +%Y-%m-%d)"
            git push
          fi