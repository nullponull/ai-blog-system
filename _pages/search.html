---
layout: default
title: "記事検索"
permalink: /search/
---

<div class="search-page">
    <div class="search-header">
        <h1>記事検索</h1>
        <p>{{ site.title }}の記事を検索できます</p>
    </div>
    
    <form class="search-form-large" id="search-form">
        <input type="search" name="q" id="search-input" placeholder="記事を検索..." class="search-input-large" />
        <button type="submit" class="search-button-large">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            検索
        </button>
    </form>
    
    <div id="search-results">
        <div id="search-loading" class="search-loading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>検索中...</p>
        </div>
        
        <div id="search-results-container"></div>
        
        <div id="no-results" class="no-results" style="display: none;">
            <p>検索結果が見つかりませんでした。</p>
            <p>別のキーワードで試してください。</p>
        </div>
    </div>
    
    <div class="search-suggestions">
        <h3>人気キーワード</h3>
        <div class="suggestion-tags">
            <a href="?q=OpenAI" class="suggestion-tag">OpenAI</a>
            <a href="?q=機械学習" class="suggestion-tag">機械学習</a>
            <a href="?q=深層学習" class="suggestion-tag">深層学習</a>
            <a href="?q=自然言語処理" class="suggestion-tag">自然言語処理</a>
            <a href="?q=Transformer" class="suggestion-tag">Transformer</a>
            <a href="?q=GPT" class="suggestion-tag">GPT</a>
            <a href="?q=画像認識" class="suggestion-tag">画像認識</a>
            <a href="?q=強化学習" class="suggestion-tag">強化学習</a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results-container');
    const searchLoading = document.getElementById('search-loading');
    const noResults = document.getElementById('no-results');
    
    // Get all posts data
    const posts = [
        {% for post in site.posts %}
        {
            title: {{ post.title | jsonify }},
            url: {{ post.url | relative_url | jsonify }},
            excerpt: {{ post.excerpt | strip_html | jsonify }},
            content: {{ post.content | strip_html | jsonify }},
            date: {{ post.date | date: '%Y年%m月%d日' | jsonify }},
            categories: {{ post.categories | jsonify }},
            tags: {{ post.tags | jsonify }},
            author: {{ post.author | default: site.author | jsonify }}
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
    ];
    
    // Get search query from URL
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');
    if (query) {
        searchInput.value = query;
        performSearch(query);
    }
    
    // Handle form submission
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const query = searchInput.value.trim();
        if (query) {
            // Update URL
            window.history.pushState({}, '', `${window.location.pathname}?q=${encodeURIComponent(query)}`);
            performSearch(query);
        }
    });
    
    function performSearch(query) {
        searchLoading.style.display = 'block';
        searchResults.innerHTML = '';
        noResults.style.display = 'none';
        
        setTimeout(() => {
            const results = searchPosts(query, posts);
            displayResults(results, query);
            searchLoading.style.display = 'none';
        }, 300);
    }
    
    function searchPosts(query, posts) {
        const queryLower = query.toLowerCase();
        const results = [];
        
        posts.forEach(post => {
            let score = 0;
            
            // Title match (highest priority)
            if (post.title.toLowerCase().includes(queryLower)) {
                score += 10;
            }
            
            // Tags and categories match
            if (post.tags.some(tag => tag.toLowerCase().includes(queryLower))) {
                score += 5;
            }
            if (post.categories.some(cat => cat.toLowerCase().includes(queryLower))) {
                score += 5;
            }
            
            // Content match
            if (post.content.toLowerCase().includes(queryLower)) {
                score += 2;
            }
            
            // Excerpt match
            if (post.excerpt.toLowerCase().includes(queryLower)) {
                score += 3;
            }
            
            if (score > 0) {
                results.push({ ...post, score });
            }
        });
        
        return results.sort((a, b) => b.score - a.score);
    }
    
    function displayResults(results, query) {
        if (results.length === 0) {
            noResults.style.display = 'block';
            return;
        }
        
        const resultsHTML = results.map(post => `
            <article class="search-result">
                <h3 class="search-result-title">
                    <a href="${post.url}">${highlightText(post.title, query)}</a>
                </h3>
                <div class="search-result-meta">
                    <span class="search-result-date">📅 ${post.date}</span>
                    <span class="search-result-author">👤 ${post.author}</span>
                    ${post.categories.length > 0 ? `<span class="search-result-category">${post.categories[0]}</span>` : ''}
                </div>
                <p class="search-result-excerpt">${highlightText(post.excerpt, query)}</p>
                ${post.tags.length > 0 ? `
                    <div class="search-result-tags">
                        ${post.tags.slice(0, 3).map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                ` : ''}
            </article>
        `).join('');
        
        searchResults.innerHTML = `
            <div class="search-results-header">
                <h2>${results.length}件の記事が見つかりました</h2>
            </div>
            ${resultsHTML}
        `;
    }
    
    function highlightText(text, query) {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }
});
</script>

<style>
.search-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
}

.search-header {
    text-align: center;
    margin-bottom: 3rem;
}

.search-header h1 {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 1rem;
}

.search-form-large {
    display: flex;
    gap: 1rem;
    margin-bottom: 3rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.search-input-large {
    flex: 1;
    padding: 1rem 1.5rem;
    border: 2px solid var(--gray-300);
    border-radius: var(--border-radius-lg);
    font-size: 1.1rem;
    transition: border-color 0.2s ease;
}

.search-input-large:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.search-button-large {
    padding: 1rem 2rem;
    background: var(--primary-green);
    color: var(--white);
    border: none;
    border-radius: var(--border-radius-lg);
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: background-color 0.2s ease;
}

.search-button-large:hover {
    background: var(--primary-green-dark);
}

.search-loading {
    text-align: center;
    padding: 3rem;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--gray-200);
    border-left: 4px solid var(--primary-green);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.search-results-header {
    margin-bottom: 2rem;
}

.search-results-header h2 {
    color: var(--gray-700);
    font-size: 1.2rem;
    font-weight: 600;
}

.search-result {
    padding: 2rem;
    border: 1px solid var(--gray-200);
    border-radius: var(--border-radius-lg);
    margin-bottom: 1.5rem;
    background: var(--white);
    transition: box-shadow 0.2s ease;
}

.search-result:hover {
    box-shadow: var(--shadow-md);
}

.search-result-title {
    margin-bottom: 1rem;
}

.search-result-title a {
    color: var(--gray-900);
    text-decoration: none;
    font-size: 1.3rem;
    font-weight: 700;
}

.search-result-title a:hover {
    color: var(--primary-green);
}

.search-result-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: var(--gray-600);
    flex-wrap: wrap;
}

.search-result-category {
    background: var(--primary-green);
    color: var(--white);
    padding: 0.25rem 0.5rem;
    border-radius: var(--border-radius);
    font-size: 0.8rem;
    font-weight: 600;
}

.search-result-excerpt {
    color: var(--gray-700);
    line-height: 1.6;
    margin-bottom: 1rem;
}

.search-result-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.search-result-tags .tag {
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
}

.no-results {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--gray-50);
    border-radius: var(--border-radius-lg);
    color: var(--gray-600);
}

.search-suggestions {
    margin-top: 3rem;
    text-align: center;
}

.search-suggestions h3 {
    color: var(--gray-700);
    margin-bottom: 1rem;
}

.suggestion-tags {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    flex-wrap: wrap;
}

.suggestion-tag {
    padding: 0.5rem 1rem;
    background: var(--gray-100);
    color: var(--gray-700);
    text-decoration: none;
    border-radius: var(--border-radius);
    font-size: 0.9rem;
    transition: background-color 0.2s ease;
}

.suggestion-tag:hover {
    background: var(--primary-green);
    color: var(--white);
}

mark {
    background: #fff3cd;
    padding: 0.1rem 0.2rem;
    border-radius: 3px;
}

@media (max-width: 768px) {
    .search-form-large {
        flex-direction: column;
    }
    
    .search-result-meta {
        flex-direction: column;
        gap: 0.5rem;
    }
}
</style>